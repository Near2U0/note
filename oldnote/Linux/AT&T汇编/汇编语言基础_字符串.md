[toc]

# 传送字符串

## movs指令

把字符串从内存一个位置传送到另一个位置

```assembly
movs

movsb ;传送单一字节
movsw	;传送䘝字(2字节)
movsl ;传送一个双字(4字节)
```

movs使用隐含的源和目的操作数，源操作数使用ESI，目的操作数使用EDI

两种方式加载ESI和EDI的值

1. 使用间接寻址，通过在内存位置标签前面添加美元符号，内存位置的地址被加载到ESI或者EDI寄存器中

   ```
   movl $output, %edi
   ```

2. LEA指令，加载一个对象的有效地址

   ```assembly
   leal output, %edi
   ;把output标签的32位内存位置加载到EDI寄存器中
   ```

![](/Users/chenyansong/Documents/note/images/linux/assemly/image-20200217103014895.png)

![image-20200217103036507](/Users/chenyansong/Documents/note/images/linux/assemly/image-20200217103036507.png)

> 可以看到每次执行MOVS指令时，数据传送后，ESI和EDI寄存器会自动改变，为另一个传送做准备



每次ESI和EDI自增的方向是由EFLAGS中的DF标志来表示的，DF=0，寄存器会递增，反之DF=1，寄存器会递减

DF清零或者是置位的操作如下：

* CLD将DF清零
* STD将DF置位



## REP前缀

重复的执行紧跟在它后面的字符串指令，知道ECX寄存器中的值为零

```assembly
leal vlaue1, %esi
leal output, %edi
movl $23, %ecx
cld
rep movsb


;快速复制的方式
;先复制整数个4字节的部分，然后复制余数(小于4字节)的部分

```

![](/Users/chenyansong/Documents/note/images/linux/assemly/image-20200217105758166.png)

![](/Users/chenyansong/Documents/note/images/linux/assemly/image-20200217105812742.png)



## 其他REP指令

通过零标志（ZF）的状态

![](/Users/chenyansong/Documents/note/images/linux/assemly/image-20200217110143443.png)

> REPE 和 REPZ是相同指令的同义词
>
> REPNE和REPNZ是相同指令的同义词



# 存储和加载字符串

## LODS，STOS

将字符串在内存和寄存器之间传递

LODS：把内存中的字符串值传送到**EAX寄存器**中

```assembly
lodsb
lodsw
lodsl

;lods使用ESI寄存器作为隐含的源操作数，ESI包含要加载寄存器的内存地址
;按照加载数据的数量递增或者递减(DF的值)ESI寄存器
```

STOS：把EAX中的值放入到内存中

```assembly
stosb
stosw
stosl

;EDI作为隐含的目标操作数
;
```

下面的程序把空格字符（ASCII值0x20)复制到256字节的缓冲区区域

![image-20200217111835355](/Users/chenyansong/Documents/note/images/linux/assemly/image-20200217111835355.png)

## 构建自己的字符串函数

通过使ESI和EDI寄存器指向相同的字符串，可以对字符串执行简单的操作，可以使用LODS指令遍历字符串，一次把一个字符串加载到AL寄存器中，对这个**字符**执行某些操作，然后使用STOS指令把新的字符加载到字符串中，如下是将ASCII字符串都转换为大写字母

![image-20200217112410777](/Users/chenyansong/Documents/note/images/linux/assemly/image-20200217112410777.png)

![image-20200217112747681](/Users/chenyansong/Documents/note/images/linux/assemly/image-20200217112747681.png)



# 比较字符串







# 搜索字符串

![](/Users/chenyansong/Library/Application Support/typora-user-images/image-20200217095849393.png)

![image-20200217095904458](/Users/chenyansong/Library/Application Support/typora-user-images/image-20200217095904458.png)