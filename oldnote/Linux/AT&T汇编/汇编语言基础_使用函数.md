[TOC]

# 定义函数

下图是函数的主体结构

![1582009726882](E:\git-workspace\note\images\linux\assemly\1582009726882.png)

函数可以在主函数中一起定义，也可以在独立的源代码文件中，然后连接到主程序

```c
float function1(int radius)
{
    float result = radius * radius * 3.14;
    return result;
}
```

# 汇编中的函数

## 编写函数

创建步骤：

1. 定义需要的输入值

   1. 使用寄存器
   2. 使用全局变量
   3. 使用堆栈

2. 定义对输入值执行的操作

   ```assembly
   .type func1, @function
   func1:
   	;.....
   ```

   

3. 定义如何生成输出值以及如何把输出值传递给调用的程序

   1. 把结果放在一个或者多个寄存器中
   2. 把结果存放在全局变量内存位置中

4. 创建函数

   ```assembly
   ;area函数的要求如下：
   ;输入值必须作为整数放在EBX中
   ;必须在主程序中创建名为value的4字节内存位置
   ;输出值被放在FPU的ST(0)寄存器中
   .type area, @function
   area:
   	fldpi
   	imull %ebx, %ebx		;输入值放在ebx中
   	movl %ebx, value
   	filds value
   	fmulp %st[0], %st[1]	;结果放在st[0]
   	
   	ret
   ```

> 函数是可以定义在主程序之前，或者之后都行
>
> 函数中使用的寄存器，使用之前要PUSHA/PUSH，使用之后要POPA/POP
>
> 如果函数的返回值放在寄存器中，那么在恢复原始寄存器值之前，必须把它传送到安全位置

## 访问函数

```assembly
call function ;访问函数
```

```assembly
movl $10, %ebx
call area
```



## 使用全局数据

函数是可以访问主程序中定义IDE内存位置，因为所有函数都可以访问这些内存位置，所以他们称之为**全局变量（global variable）**，函数可以将全局变量用于任何目的，包括主程序和函数之间传递数据

```assembly

```







# 按照C样式传递数据值



# 使用独立的函数文件







![1582009480141](C:\Users\landun\AppData\Roaming\Typora\typora-user-images\1582009480141.png)