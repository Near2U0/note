---
title: 磁盘介绍
categories: linux   
tags: [linux]
---



[TOC]




# 1.磁盘相关的名词
|英文|汉语|
|-|-|
|Disk|磁盘|
|Head|磁头|
|sector|扇区|
|Track|磁道|
|Cylinder|柱面|
|Units|单元快(一个柱面的大小|
|Block|数据块|
|INode|索引节点|



# 2.磁盘实体图

![磁头,主轴](http://ols7leonh.bkt.clouddn.com//assert/img/linux/磁盘/1.png "磁头,主轴")
![柱面,磁柱](http://ols7leonh.bkt.clouddn.com//assert/img/linux/磁盘/2.png "柱面,磁柱")
![扇区,磁道](http://ols7leonh.bkt.clouddn.com//assert/img/linux/磁盘/3.png "扇区,磁道")





 &emsp;扇区:盘面由圆心向四周画直线,不同的磁道被直线分成许多的扇形(弧形)的区域,每个弧形的区域叫做扇区,每个扇区大小一般为512字节,扇区看起来就是圆弧或扇形
柱面:磁盘中不同的盘片(或盘面)相同半径的磁道轨迹从上到下所组成的圆柱型区域就称为柱面,柱面看起来是一个圆柱形
&emsp;扇区的第一个主要部分是标识符,标识符就是扇区头标,包括组成扇区三维地址的三个数字,扇区所在的磁头(或盘面)/磁道(或柱面号)以及扇区在磁道上的位置即扇区号,头标中还包括一个字段,其中有显示扇区是否能可靠存储数据,或者是是否已发现某个故障因而不宜使用的标记,有些磁盘控制器在扇区头标中还记录有指示字,可在原扇区出错时指引磁盘转到替换扇区或磁道,最后,扇区头标以循环冗余校验(CRC)值作为结果以供控制器检验扇区头标的读出情况,确保准确无误
&emsp;扇区的第二个主要部分是存储数据的数据段,可分为数据和保护数据的交错码(ECC),在初始化准备期间,计算机用512个虚拟信息字节(实际数据的存放地)和这些虚拟信息字节相应的ECC数字填入这个部分

&emsp;磁道,柱面,扇区总结
&emsp;磁盘最基本的组成部分是由坚硬的金属材料制成的涂以磁性介质的盘片(有很多层)不同容量磁盘的盘片数不等
1. 一块磁盘有2-14个盘片,每个盘片有两个面,每个面对应一个读写磁头,用磁头号来区分盘面,即盘面就是磁头数,盘片数*2=磁头数(盘面数)
2. 不同盘面的磁道被划分为多个扇形区域,每个扇形区域就是一个扇区
3. 同一个盘面,以盘片中心为圆心,每个不同半径的圆形轨迹就是一个磁道(Track)
4. 不同盘面相同半径的磁道组成一个圆柱面就是柱面(Cylinder)
5. 一个柱面包含多个磁道(这些磁道半径相同),一个磁道包含多个扇区
6. 数据信息记录可表示为:某磁头,某磁道(柱面),某扇区


# 3.磁盘容量计算
磁盘容量=柱面数(磁道数)*柱面大小(磁道大小*磁头数)=512B*扇区数*磁道数*磁头数

```
[root@lamp01 ~]# fdisk -l /dev/sdb
 
Disk /dev/sdb: 1073 MB, 1073741824 bytes
255 heads, 63 sectors/track, 130 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk identifier: 0x000315a8
 
   Device Boot      Start         End      Blocks   Id  System
/dev/sdb1               1          13      102400   83  Linux
Partition 1 does not end on cylinder boundary.
/dev/sdb2              13          77      512000    5  Extended
Partition 2 does not end on cylinder boundary.
/dev/sdb5              14          39      204800   83  Linux
/dev/sdb6              39          77      305152   83  Linux

```

# 4.机械磁盘读写数据的原理
1. 磁盘是按照柱面为单位读写数据的，即先读取同一个盘面的某一个磁道，读完之后，如果数据没有读完，磁头也不会切换到其他的磁道，而是选择切换磁头，读取下一个盘面的相同半径的磁道，知道所有盘面的相同半径的磁道读取完成之后，如果数据还没有读写完成，才会切换其他不同半径的磁道，这个切换磁道的过程为寻道。
2. 不同磁头间的切换是电子切换，而不同磁道间的切换需要磁头做径向运动，这个径向运动需要步进电机调节，这个动作是机械的切 换。
寻道：是机械的，所以很浪费时间

&emsp;为什么按照柱面的方式读写数据？
因为同一个柱面上我只要让磁头做电子的切换（即一个磁头读完一个柱面上的一个磁道就电子让下一次磁头读取同一个柱面上的下一个磁道），就能够读取数据（显然电子的切换相比较机械的切换要快很多）


# 5.磁盘分区的介绍

## 5.1.磁盘存储逻辑结构图

![磁盘存储逻辑结构图](http://ols7leonh.bkt.clouddn.com//assert/img/linux/磁盘/4.png "磁盘存储逻辑结构图")

 MBR:主引导记录，0磁头，0磁道，1扇区，446字节



## 5.2.分区表示意图

![分区表示意图](http://ols7leonh.bkt.clouddn.com//assert/img/linux/磁盘/5.png)



## 5.3.16字节分区表含义

![16字节分区表含义](http://ols7leonh.bkt.clouddn.com//assert/img/linux/磁盘/6.png)



## 5.4.备份主引导记录


![备份主引导记录](http://ols7leonh.bkt.clouddn.com//assert/img/linux/磁盘/7.png)

## 5.5.磁盘分区小结

1. 磁盘分区的实质就是针对上述0磁头0磁道1扇区的前446字节后面接下来的64byte的分区表进行设置，
即主要划分起始以及结束磁头号，及扇区号和柱面号
2. 一块磁盘的分区表仅有64byte大小，每个分区表要占用16字节，因此一块磁盘仅支持4个分区表信息，
即：主分区+扩展分区的总量不超过4个
3. 扩展分区是不能直接使用的，还需要在扩展分区的基础上划分逻辑分区才行。
4. 扩展分区有自己的分区表，因此扩展分区下面的逻辑分区可以有多个。

## 5.6.主分区primary
一般来说，主分区是磁盘上必须存在的分区，一般我们在主分区上安装操作系统


## 5.7.扩展分区
&esmp;严格来说,扩展分区不能算一个正常的分区,而是一个链接,起到一个指向的作用,我们可以在扩展分区内建立逻辑分区,从上面逻辑结构图中我们可以看到,扩展分区就像一个虚拟出来的一个小硬盘一样,但是不同的是,没有MBR,而只有扩展分区表,而且这个扩展分区表是没有64bytes的限制的,所以可以在扩展分区划分多个逻辑分区
&esmp;一块硬盘只能存在一个扩展分区,并且扩展分区不能直接存放数据,扩展分区受限于操作系统


## 5.8.逻辑分区logical
&esmp;不能在磁盘中单独直接划分逻辑分区(fdisk),逻辑分区必须存在于扩展分区内,在扩展分区内可以划分多个逻辑分区,逻辑分区的编号从数字5开始,在这个扩展分区内可以划分多个逻辑分区(IDE磁盘大概编号可以是5-63), SATA(编号是5-15)
&esmp;实际应用:主分区和逻辑分区,都可以用,一般系统安装在主分区中,存放数据都可以



## 5.9.分区的注意事项
&emsp;一块硬盘的分区方式只能为如下组合之一：
P + P + P + P
P + P + P + E
P + P + E
P + E
P
其中的P为primary，E为Extended

1. 扩展分区不是一个真正可用的分区，建立扩展分区之后，还需要在扩展分区上面建立逻辑分区才可以使用。
2. 对于主分区和逻辑分区在一般的数据存储使用上是没有区别的（对于大多数的数据存储），在安装操作系统时
第一个分区要选主分区
3. 分区号1-4留给主分区或扩展分区使用，逻辑分区只能从5开始，即使1-4分区号有剩余，也不会分配给逻辑分区。
4. 对硬盘分区，实际上就是在修改硬盘的分区表，也就是说我们通过fdisk分区实际上就是在改64字节的分区表，分区和对应的数据没有关系，因此理论上调整分区大小，不会删除分区内的数据。
特殊说明:磁盘也可以不分区,直接格式化使用,但是不推荐这样做, 主分区最少有一个，而扩展分区最多一个


## 5.10.磁盘分区方案
> 方案1:集群架构中的某个节点,数据有多份或者不重要

/boot 100MB linux引导程序
swap 物理内存的1.5倍,当内存大于等于8GB时,给8GB即可
/ 剩余硬盘大小(相当于Windows只分C盘)

> 方案2:数据库即存储,有大量重要的数据

/boot 100MB
/ 50-200GB
swap 物理内存的1.5倍,当内存大于等于8GB时,给8GB即可
/data 剩余硬盘大小,放数据库及存储数据的

> 方案3:门户级别或大网站

/boot 100MB
swap 物理内存的1.5倍,当内存大于等于8GB时,给8GB即可
/ 50-200GB
剩余空间保留,不再进行分区,将来分给哪个部分,拿到服务器的部分,就自己根据需求再分,此种方式更灵活

参见：http://oldboy.blog.51cto.com/2561410/634725

## 5.11.磁盘分区设备名
&emsp;以硬盘为目标来说明设备命名规则。linux将硬盘分为两类：第一类是传统的IDE硬盘，使用hd标示；第 二种是SATA、SCSI、USB硬盘、U盘（严格的说U盘不算硬盘）等，均用sd标示；对于SATA，SCSI，USB硬盘，U盘等，只要把hd改成sd就可以了。命名规则是相同的。
&emsp;对应于：第一块硬盘：sda   //我们使用a，b，c表示第几块盘
&emsp;如果第一块盘有1个主分区和1个扩展分区，2个逻辑分区
对应于：sda1   //主分区
        sda2   //扩展分区
        sda5   //逻辑分区
        sda6   //逻辑分区
注意：我们使用1,2,3.。。来表示不同的分区号
&emsp;每个硬盘只能有四个主分区和扩展分区（三个主分区+一个扩展分区，或者四个主分区），这个是由硬盘本身决定的（64字节，每个分区表16字节），
跟操作系统没关系。每个硬盘最多只能有一个扩展分区，这个是由操作系统限制的。我的理解，扩展分区只是标志该分区处被再次分成多个逻辑分区了，因此扩展分区相当于逻辑分区的容器而已，没有必要多个，因此OS限制了扩展分区最多只能有一个。


[整理自老男孩](http://oldboy.blog.51cto.com/)


