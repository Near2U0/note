---
title: 磁盘分区,格式化,挂载
categories: linux   
tags: [linux]
---



# 1.磁盘分区工具
## 1.1.fdisk

### 1.1.1.查看所有分区
```
[root@lamp01 ~]# fdisk -l
#第一块磁盘
Disk /dev/sda: 8589 MB, 8589934592 bytes
255 heads, 63 sectors/track, 1044 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk identifier: 0x000e7a75    

   Device Boot      Start         End      Blocks   Id  System
/dev/sda1   *           1          26      204800   83  Linux
Partition 1 does not end on cylinder boundary.
/dev/sda2              26          91      524288   82  Linux swap / Solaris
Partition 2 does not end on cylinder boundary.
/dev/sda3              91        1045     7658496   83  Linux
 
#第二块磁盘
Disk /dev/sdb: 1073 MB, 1073741824 bytes
255 heads, 63 sectors/track, 130 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk identifier: 0x000315a8    
 
   Device Boot      Start         End      Blocks   Id  System
/dev/sdb1               1          13      102400   83  Linux
Partition 1 does not end on cylinder boundary.
/dev/sdb2              13          77      512000    5  Extended
Partition 2 does not end on cylinder boundary.
/dev/sdb5              14          39      204800   83  Linux
/dev/sdb6              39          77      305152   83  Linux

```

### 1.1.2.给/dev/sdb分区
#### 1.1.2.1.参数简绍
```
[root@lamp01 ~]# fdisk /dev/sdb
 
WARNING: DOS-compatible mode is deprecated. It's strongly recommended to
         switch off the mode (command 'c') and change display units to
         sectors (command 'u').
#警告的含义:DOS命令行已经过时,采用-c切换命令行,原来默认的磁盘最小单元为柱面,使用-u切换成扇区
 
Command (m for help): 


-m    # 帮助命令
-p    #打印分区表
-d    #删除分区
-n    #添加分区
-t    #改版分区类型
-l    #查看分区类型
-q    #不保存退出
-w    #保存退出


```

#### 1.1.2.2.新建一个扩展分区

![新建一个扩展分区](http://ols7leonh.bkt.clouddn.com//assert/img/linux/磁盘/8.png "新建一个扩展分区")

#### 1.1.2.3.新建一个逻辑分区

![新建一个逻辑分区](http://ols7leonh.bkt.clouddn.com//assert/img/linux/磁盘/9.png "新建一个逻辑分区")

#### 1.1.2.4.改版分区类型
```
Command (m for help): L  #查看所有的分区类型号
 
 0  Empty           24  NEC DOS         81  Minix / old Lin bf  Solaris       
 1  FAT12           39  Plan 9          82  Linux swap / So c1  DRDOS/sec (FAT-
 2  XENIX root      3c  PartitionMagic  83  Linux           c4  DRDOS/sec (FAT-
 3  XENIX usr       40  Venix 80286     84  OS/2 hidden C:  c6  DRDOS/sec (FAT-
 4  FAT16 <32M      41  PPC PReP Boot   85  Linux extended  c7  Syrinx        
 5  Extended        42  SFS             86  NTFS volume set da  Non-FS data   
 6  FAT16           4d  QNX4.x          87  NTFS volume set db  CP/M / CTOS / .
 7  HPFS/NTFS       4e  QNX4.x 2nd part 88  Linux plaintext de  Dell Utility  
 8  AIX             4f  QNX4.x 3rd part 8e  Linux LVM       df  BootIt        
 9  AIX bootable    50  OnTrack DM      93  Amoeba          e1  DOS access   
 
```

![改变分区类型](http://ols7leonh.bkt.clouddn.com//assert/img/linux/磁盘/10.png "改变分区类型")
 

#### 1.1.2.5.保存上面的分区操作

![改变分区类型](http://ols7leonh.bkt.clouddn.com//assert/img/linux/磁盘/11.png "改变分区类型")


#### 1.1.2.6.使分区/dev/sdb生效(重读分区表)

```
partprobe /dev/sdb
```

### 1.1.3.非交互式,一次执行上面的操作
```
echo -e “n\np\n1\n\n+10G\nn\np\n2\n\n+20G\nw” |fdisk /dev/sdb
```

## 1.2.parted
&emsp;简述：parted是一个磁盘分区的管理工具，他比fdisk更加的灵活，功能也更加的丰富，同时还支持GUID分区表,这在IA64平台上管理磁盘时非常有用，他同时支持交互模式和非交互模式，他除了能够进行分区的添加，删除等
常见操作外，还可以移动分区，制作文件系统，调整文件系统的大小。
&emsp;GPT分区全名：Globally Unique Identitier Partition Table Format ,指全局唯一标示磁盘分区表格式。由于MBR分区标的最大可寻址的存储空间只有2Tb(232*512字节)，因此在大硬盘出现的现在，MBR分区方式逐渐被GUID分区表取代。

parted 与fdisk区别:
1. 支持gpt分区表,可以对大于2T的磁盘分区
2. 分区直接生效,不需要使用命令写入磁盘,最好partprobe /dev/sdb
3. 格式化挂载等和fdisk无区别

### 1.2.1交互式
```
[root@lamp01 ~]# parted /dev/sdb    #对/dev/sdb进行分区
GNU Parted 2.1
使用 /dev/sdb
Welcome to GNU Parted! Type 'help' to view a list of commands.
(parted) p             #打印                                                   
Model: VMware, VMware Virtual S (scsi)
Disk /dev/sdb: 1074MB
Sector size (logical/physical): 512B/512B
Partition Table: msdos
 
Number  Start   End    Size   Type      File system  标志
 1      1049kB  106MB  105MB  primary   ext4
 2      106MB   630MB  524MB  extended
 5      107MB   317MB  210MB  logical
 6      318MB   630MB  312MB  logical
 
(parted) 

```


![改变分区类型](http://ols7leonh.bkt.clouddn.com//assert/img/linux/磁盘/12.png "改变分区类型")


### 1.2.2添加分区:非交互式
![非交互式](http://ols7leonh.bkt.clouddn.com//assert/img/linux/磁盘/13.png "非交互式")

 其中mkfs是格式化,创建文件系统, mount是挂载
 
### 1.2.3非交互式:忽略提示
![非交互式](http://ols7leonh.bkt.clouddn.com//assert/img/linux/磁盘/14.png "非交互式")
 
### 1.2.4.删除一个分区

![删除一个分区](http://ols7leonh.bkt.clouddn.com//assert/img/linux/磁盘/15.png "删除一个分区")
 
### 1.2.5.退出
```
quit
```

### 1.2.6.注意:gpt到msdos的转化
```
parted   /dev/sdb mklabel   msdos
```

# 2.格式化
&emsp;实质：就是创建文件系统
```
帮助：
[root@data-1-2 ~]# mkfs.ext4 -help
mkfs.ext4: invalid option -- 'h'
Usage: mkfs.ext4 [-c|-l filename] [-b block-size] [-f fragment-size]
        [-i bytes-per-inode] [-I inode-size] [-J journal-options]
        [-G meta group size] [-N number-of-inodes]
        [-m reserved-blocks-percentage] [-o creator-os]
        [-g blocks-per-group] [-L volume-label] [-M last-mounted-directory]
        [-O feature[,...]] [-r fs-revision] [-E extended-option[,...]]
        [-T fs-type] [-U UUID] [-jnqvFKSV] device [blocks-count]
 
-L 是指定卷标，相当于给分区取的名字，那么挂载的时候直接用卷标名来挂载

[root@data-1-2 ~]# mkfs.ext4 -L MYDATA /dev/sdb3
mke2fs 1.41.12 (17-May-2010)
Filesystem label=MYDATA
    ......

```

> 方式一

```
[root@linux-study ~]# mkfs.ext4 /dev/sdb1

```

> 方式二

```
mkfs -t ext4 /dev/sdb1

#可以指定iNode和block的大小,但是一般我们不指定
mkfs -t ext4 -I 1024 -b 8192 /dev/sdb1
```

格式化之后出现的提示：

![格式化之后出现的提示](http://ols7leonh.bkt.clouddn.com//assert/img/linux/磁盘/16.png "格式化之后出现的提示")
 
2次挂载或者180天之后会自动检查，我们可以取消他，如上图

```
[root@data-1-2 ~]# mkfs.ext4 /dev/sdb1
mke2fs 1.41.12 (17-May-2010)
Filesystem label=
OS type: Linux
Block size=1024 (log=0)
Fragment size=1024 (log=0)
Stride=0 blocks, Stripe width=0 blocks
130560 inodes, 522080 blocks
26104 blocks (5.00%) reserved for the super user  #默认留5%的空间大小给超级管理员，-m指定
First data block=1
Maximum filesystem blocks=67633152
64 block groups   #创建了64个块组
8192 blocks per group, 8192 fragments per group  #每个块组8192个block
2040 inodes per group
Superblock backups stored on blocks:   #超级块备份在下面的组中
        8193, 24577, 40961, 57345, 73729, 204801, 221185, 401409
 
Writing inode tables: done                           
Creating journal (8192 blocks): done   #写日志完成
Writing superblocks and filesystem accounting information: done
 
This filesystem will be automatically checked every 27 mounts or
180 days, whichever comes first.  Use tune2fs -c or -i to override.
```

> 格式化交换分区

```
#在格式化之前的分区，要指定分区类型t=82
[root@data-1-2 tdir]# mkswap /dev/sdb4

```

# 3.挂载分区
实质：为文件系统指定访问入口

```
[root@linux-study /]# mount /dev/sdb1 /mnt 
mount -a     #表示挂载/etc/fstab文件中所有的文件系统
mount -n    #默认情况下，mount命令每挂载一个设备，都会将挂载的设备信息保存至 /etc/mtab
而使用-n表示不将信息写入到/etc/mtab文件中
mount -t 指定正在挂载的设备的文件系统类型，不指定默认是调用blkid /dev/sdb1来获取文件系统的类型
mount -r 只读挂载
mount -w 读写挂载
mount -o 指定额外的挂载选项
   async ：异步写入
   atime：跟新inode的访问时间
   auto：使用的是-a选项
   default：包含：rw/suid/dev/exec/auto/nouser/async

#检查挂载情况
df -h 查看block大小
df -i 查看inode


#挂载交换分区
[root@data-1-2 tdir]# swapon /dev/sdb4
[root@data-1-2 tdir]# swapoff /dev/sdb4


#挂载ISO镜像文件
mount -o loop /root/tes.iso /media
ll /media/

#卸载：
umount 设备/挂载点

```


# 4.设置开机自动挂载
开机时将自动挂载/etc/fstab下的挂载项
如果没有这一项，再次重启的时候，将不会自动挂载分区，那么将不能写入文件到该分区
vim /etc/fatab 添加：

```
/dev/sdb1 /mnt ext4 defaults 0 0
```

# 5.加载/etc/fstab进行挂载测试（很重要）
```
mount -a
   Mount all filesystems (of the given types) mentioned in fstab.

#如果这里不进行测试，那么重启的时候，加载fatab可能机器起不来了，所以很重要

```


# 案例
&emsp;如果我要将我的一块大硬盘暂时分成四个分区,同时,还希望有其他的空间可以让我在未来需要的时候再进行分区,那么该如何分区?
3p+1e(1L) 剩下的空间保留
2p+1e(2L) 剩下的空间保留
1p+1e(3L) 剩下的空间保留


[整理自老男孩](http://oldboy.blog.51cto.com/)
