[TOC]

# vim的模式



* 编辑模式（命令模式；默认是这个模式）
* 输入模式
* 末行模式: 在编辑模式下 输入 冒号





## 末行模式



```
# 进入末行模式
在编辑模式下输入冒号

# 在末行模式下显示行号
:set nu


# 在末行模式下跳转到指定的行
:number

# 在末行模式下删除行
:50,51d # 删除50，51行
:10d  # 删除第10行

#回到编辑模式
按ESC*2


# 末行模式下还有替换，保存退出，设置行号，详细的见下面
```





# 快捷键

## 移动光标的方法



| 移动光标的方法 |                                                              |
| -------------- | ------------------------------------------------------------ |
| h              | 左移                                                         |
| j              | 下                                                           |
| k              | 上                                                           |
| i              | 右移                                                         |
| 30j；其他同理  | 向下移动30行                                                 |
| ctrl+f         | 向下移动一页                                                 |
| ctrl+b         | 向前翻一页                                                   |
| ctrl+d         | **向下翻半屏**                                               |
| ctrl+u         | **向上翻半屏**                                               |
| n<space>       | 那个 n 表示“数字”，20<space> 则光标会向后面移动 20个字符距离 |
| 0              | 数字0：移动到这一行的最前面字符                              |
| $              | **移动到这一行的最后一个字符**                               |
| ^              | 跳转到第一个非空白字符                                       |
| H              | 移动到屏幕最上方第一行的第一个字符                           |
| M              | 移动到屏幕中间的一行的第一个字符                             |
| L              | 移动到屏幕最下方一行的第一个字符                             |
| G              | 移动到这个文件的最后一列                                     |
| nG             | 移动到文件第n列（配合 :set nu 使用）                         |
| gg             | 移动到文件的第一列                                           |
| n<Enter>       | 光标下移n列                                                  |

| 单词跳 |                              |
| ------ | ---------------------------- |
| w      | 移动至下一个单词的词首       |
| e      | 调至当前或者下一个单词的词尾 |
| E      | 相对于e跳的幅度大一些        |
| b      | 调至当前或者下一个单词的词首 |
| B      | 相对于b跳的幅度大一些        |





## 搜索


| 搜索      |                                                              |
| --------- | ------------------------------------------------------------ |
| **/word** | **向光标之下搜索一个名称为word的字符串**                     |
| **?word** | **向上搜索一个名称为word的字符串**                           |
| **n**     | **重复前一个搜索动作；如果前一次是向上搜索，那么此时就会继续向上搜索，但是如果前一次是向下搜索，那么此时会继续向下搜索** |
| **N**     | **重复前一个动作的相反动作**                                 |
| **#**     | **先将光标移动到要查找的单词上，然后按#，#的意思就是锚点一样，这样也能实现上面查找的功能** |



## 替换

| 替换    |         |
| --------- | ---------- |
| :n1,n2s/word1/word2/g | n1,n2为数字，在第n1与n2列之间寻找word1这个字符串，并用word2替换 |
| :1,$s/word1/word2/g   | 从n1到最后一行之间，替换                                     |
| :1,$s/word1/word2/gc  | 从n1到最后一行之间，替换，每一次替换都提示使用者确认（comfirm） |

| 字符替换 |                                                            |
| -------- | ---------------------------------------------------------- |
| r        | 将光标所在字符替换为你输入的字符<br>只能实现单个字符的替换 |



## 删除，复制，粘贴

| 删除，复制，粘贴 |                                                              |
| ---------------- | ------------------------------------------------------------ |
| **x or X**       | **在一列字当中，x 为向后删除一个字符 （相当于 [del] 按键） ， X 为向前删除一个字符（相当于 [backspace] 亦即是倒退键）** |
| nx               | 连续向后删除n个字符                                          |
| **dd**           | **删除光标所在的那一整行**                                   |
| **ndd**          | **向下删除光标所在的n行**                                    |
| d1G              | 删除光标所在行到第一行的所有数据                             |
| dG               | 删除光标所在行到最后一行的所有数据                           |
| **d$**           | **删除光标所在处到该行的最后一个字符**                       |
| **d0**           | **删除光标所在处到该行的第一个字符；在插入模式下，ctrl+u也是实现同样的功能** |
| dw               | 删除一个Word(删除光标处到Word结尾的字符)                     |
| dW               | 删除一个长Word                                               |
| **D**            | **删除到行尾**                                               |
| **yy**           | **复制光标所在的那一行**                                     |
| **nyy**          | **向下复制n行**                                              |
| y1G              | 复制当前行到第一行的所有数据                                 |
| yG               | 复制当前行到最后一行的所有数据                               |
| y0               | 复制光标所在字符到行首的所有数据                             |
| y$               | 复制光标所在字符到行尾的所有数据                             |
| **P**            | **如果删除或者复制的内容为整行，则粘贴光标所在行的上方<br>如果复制或者粘贴的内容为非整行，则粘贴至光标所在字符的前面** |
| **p**            | **如果删除或者复制的内容为整行，则粘贴光标所在行的下方<br>如果复制或者粘贴的内容为非整行，则粘贴至光标所在字符的后面** |
| J  (大写)        | 将光标所在行与下一行合并成为一行                             |
| cc               | 删除整行，然后进入到insert模式                               |
| c$               | 删除光标到行尾，然后进入到insert模式; ctrl+c也是             |
| c0               | 删除光标(不包括光标)到行首，然后进入到insert模式             |
| **u**            | **撤销**                                                     |
| **ctrl+r**       | **重做上一个动作**                                           |
| .                | 重复前一个动作                                               |



## 命令行界面的储存、离开等指令



| 命令行界面的储存、离开等指令 |                                                              |
| ---------------------------- | ------------------------------------------------------------ |
| :w                           | 写入磁盘（保存）                                             |
| :w!                          | 强制写入                                                     |
| :q                           | 退出                                                         |
| :q!                          | 强制退出，不保存                                             |
| :wq                          | 保存退出                                                     |
| :w [filename]                | 将编辑的文件存入另一个指定文件（相当于另存为）               |
| :n1, n2 w [filename]         | 将n1到n2的内容存储到另一个文件中                             |
| :!  command                  | 暂时离开vim 到命令行界面执行command的显示结果  <br> （例如： ":! ls /home" 在vim中查看 home目录下的文件） |



## 缩进

```shell
#向右缩颈
>>
#向左缩颈
<<
```



## 编辑模式

```shell
#字符插入
I
i
#行插入
O 
o

#
s #删除光标后面的字符为代价，进入插入模式
S #删除光标所在的整行为代价，进入插入模式
```





## vim环境的变更



| vim环境的变更 |                |
| ------------- | -------------- |
| :set nu       | 设置行号       |
| :set nonu     | 取消设置的行号 |

## 撤销



| 撤销 |                |
| ---- | -------------- |
| u    | 撤销前一次操作 |
|      |                |

## 重复前一次的操作



| 点   |                |
| ---- | -------------- |
| .    | 重复前一次操作 |




# 区块选择(可视模式)



## 字符选择



| 按键                                         | 意义                                                         |
| -------------------------------------------- | ------------------------------------------------------------ |
| v（小写）                                    | 字符选择，会将光标经过的地方反白选择（可以使用hjkl 选择），之后可以进行复制(y)或者是删除操作(d),然后进入剪切板，之后还可以对剪切板中的内容进行粘贴操作 |
| V（大写）                                    | 行选择，会将光标经过的行反白选择                             |
| [Ctrl]+v｜块选择，可以用长方形的方式选择数据 | （可以使用hjkl 选择），之后可以进行复制(y)或者是删除操作(d),然后进入剪切板，之后还可以对剪切板中的内容进行粘贴操作 |



## 自动跳转到帮助文档

```shell
#光标在指定的字符上，如：printf 这个字符上
#shift + k ，就能够跳转到printf的man文档上

#我们搜索一个函数的帮助文档的时候，可能一个函数对应有多个章节，所以在跳转之前，如果我们知道对应的章节，那么：3K(shift+k) ,就跳转到第3张的printf

#退出man文档，就：q
```





## 选择之后的操作

 

| 按键 | 意义             |
| ---- | ---------------- |
| y    | 将反白的地主复制 |
| d    | 将反折的地方删除 |





## 举例



下面实际进行我们需要的操作。就是将host再加到每一行的最后面，我们可以这样作：

1. 将光标移动到第一行的host那个h上头，然后按下[Ctrl]+v，左下角出现块示意 



![](E:\note\images\vim\block1.png)



2. 将光标移动到最底部，此时光标移动过的区域会反白  

![](E:\note\images\vim\block2.png)

3. 此时可以按下”y”来进行复制，当你按下y之后，反白的块就会消失不见。
4. 最后，将光标移到到第一行的最右边，并且再用编辑模式向右按两个空格键，回到一般模式后，再按”p”后，你会发现很有趣 

![](E:\note\images\vim\block3.png)



转自：https://blog.csdn.net/weixin_36210698/article/details/72895910

## 多行注释

1. 首先按esc进入命令行模式下，按下Ctrl + v，进入列（也叫区块）模式;
2. 在行首使用上下键选择需要注释的多行;
3. 按下键盘（大写）“I”键，进入插入模式；
4. 然后输入注释符（“//”、“#”等）;
5. 最后按下“Esc”键。

注：在按下 esc键后，会稍等一会才会出现注释，不要着急~~时间很短的



# 多文件编辑，多窗口编辑



## vim一个窗口打开多个文件

```
# 先打开文件
vim test.py test2.py test3.py

在末行模式下
:files 查看文件列表
:next 切换到下一个文件
:prev 切换到前一个文件
:last 切换到最后一个文件
:first 切换至第一个文件


# 再输入指令，打开同一个文件
:sp
```



## vim一个文件多个窗口打开



通常用于将一个文件多窗口打开，进行对比

```shell
vim file1.log
# 水平分隔
#:sp  进入水平分屏
ctrl+w*2 #进行屏幕切换


#垂直分隔
#:vsp
ctrl+w*2 #进行屏幕切换


#分屏的同时打开新的文件
#:vsp xxx.file

# 退出
:q	#退出当前
:qa 	#关闭所有窗口

```



## 多文件多窗口打开



* 打开


| 操作                       | 说明                 |
| -------------------------- | -------------------- |
| vim -O test1.log test2.log | 同时垂直打开多个文件 |
| vim -o test1.log test2.log | 水平分隔             |

* 文件列表

| 操作   | 说明 |
| ------ | ---- |
| :files |      |



```
:files
  1 %a   "hosts"                        第 10 行
  2  a   "ip2"                          第 0 行
```





* 切换窗口


| 操作   | 说明                                       |
| ------ | ------------------------------------------ |
| ctrl+w | 实现多个文件之间的切换（需要按ctrl+w两次） |





文件间切换（一个窗口，但是打开了多个文件）

| 操作   | 说明       |
| ------ | ---------- |
| Ctrl+6 | 下一个文件 |
| :bn    | 下一个文件 |
| :bp    | 上一个文件 |



* 同时打开了多个窗口切换

对于用(v)split在多个窗格中打开的文件，这种方法只会在当前窗格中切换不同的文件。

| 操作           | 说明                         |
| -------------- | ---------------------------- |
| Ctrl+w+方向键  | 切换到前／下／上／后一个窗格 |
| Ctrl+w+h/j/k/l | 同上                         |
| Ctrl+ww        | 依次向后切换到下一个窗格中   |









## 保存退出



| 操作 | 说明               |
| ---- | ------------------ |
| :qa  | 退出所有的编辑窗口 |
| :q   | 退出当前窗口       |





参见：https://harttle.land/2015/11/14/vim-window.html

https://blog.csdn.net/orangleliu/article/details/41745975





# 自动补全



这里使用的是一个插件：YouCompleteMe



https://blog.csdn.net/freeking101/article/details/78539005





# 打开文件跳转到指定的行



```
# 打开文件，并定位第#行
vim +# filename

# 打开文件，定位至最后一行
vim + filename

# 打开文件，定位至第一次被Pattern匹配的行的行首
vim +/Pattern filename

#打开文件，并跳转到指定的行
vim ./Plugin/eventreport/EventReport.cpp +155
```



# 末行模式的set

* 自动缩进

```
:set autoindent  #自动缩进
:set ai
:set noai

```

```shell
#行跳转
:100

#执行命令,比如，查看当前目录
:!pwd
```



* 查找到的文本高亮显示或取消

```
:set hlsearch
:set nohlsearch

```



# vim配置文件



```
# 全局
vim /etc/vimrc

# 个人的家目录下
vim ~/.vimrc
```



# 将vim打造成IDE

![](/Users/chenyansong/Documents/note/images/linux/command/image-20191102112359946.png)



# 其他问题



有时，我们在Windows和linux中的同一个脚本在Windows是可以执行的，但是放到linux中时不能执行，此时可能的原因：

* 字符编码的问题，在dos中的换行是^M$    ，而在linux中的换行为$，我们可以使用 cat -A test.sh查看是否存在这样的问题

  


解决的方式：



```
# 安装
rpm -ivh /mnt/Packages/dos2unix-*   


[dmtsai@study ~]$ dos2unix [-kn] file [newfile]
[dmtsai@study ~]$ unix2dos [-kn] file [newfile]
选项与参数：
-k ：保留该文件原本的 mtime 时间格式 （不更新文件上次内容经过修订的时间）
-n ：保留原本的旧文件，将转换后的内容输出到新文件，如： dos2unix -n old new

范例一：将 /etc/man_db.conf 重新复制到 /tmp/vitest/ 下面，并将其修改成为 dos 断行
[dmtsai@study ~]# cd /tmp/vitest
[dmtsai@study vitest]$ cp -a /etc/man_db.conf .
[dmtsai@study vitest]$ ll man_db.conf
-rw-r--r--. 1 root root 5171 Jun 10 2014 man_db.conf
[dmtsai@study vitest]$ unix2dos -k man_db.conf
unix2dos: converting file man_db.conf to DOS format ...
# 屏幕会显示上述的讯息，说明断行转为 DOS 格式了！
[dmtsai@study vitest]$ ll man_db.conf
-rw-r--r--. 1 dmtsai dmtsai 5302 Jun 10 2014 man_db.conf
# 断行字符多了 ^M ，所以容量增加了！


范例二：将上述的 man_db.conf 转成 Linux 断行字符，并保留旧文件，新文件放于 man_db.conf.linux
[dmtsai@study vitest]$ dos2unix -k -n man_db.conf man_db.conf.linux
dos2unix: converting file man_db.conf to file man_db.conf.linux in Unix format ...
[dmtsai@study vitest]$ ll man_db.conf*
-rw-r--r--. 1 dmtsai dmtsai 5302 Jun 10 2014 man_db.conf
-rw-r--r--. 1 dmtsai dmtsai 5171 Jun 10 2014 man_db.conf.linux
[dmtsai@study vitest]$ file man_db.conf*
man_db.conf: ASCII text, with CRLF line terminators # 很清楚说明是 CRLF 断行！
man_db.conf.linux: ASCII text

```



vim中粘贴出现乱码的问题

```
在vi/vim普通模式下执行:set paste命令，再按 i 插入就会保留原文件格式

:set paste 打开粘贴命令
:set nopaste 关闭命令
:h paste 帮助

```



 







