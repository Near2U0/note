---
title: zk分布式锁的类型
categories: hadoop   
tags: [zookeeper]
---



[TOC]



# 排他锁


* 定义:只能允许一个线程获得,其他线程都需要等待已经获取的线程完成才能再次争抢资源
* zk实现:
	* 获得锁:通过构建一个目录,当叶子节点能创建成功,则任务获取到锁,因为一旦一个节点被某个会话创建,其他会话再次创建这个节点时,将会抛出异常,比如目录为:
	![](http://ols7leonh.bkt.clouddn.com//assert/img/bigdata/zookeeper/lock/1.png)

	* 释放锁:删除节点或者会话失效



# 共享锁

* 定义:
读锁:如果前面线程使用的是读锁,则后面的线程还可以获取读锁,从而可以继续进行读操作
写锁:如果在线程打算获取锁从而进行操作时,无论前面已经有读锁或者是写锁都必须进入等待


* zk实现:
	* 获得读锁:利用zk节点的顺序性,对于读操作,节点名称带一个R标识,如果前面存在序列数比自己小,并且都是带R标识,则说明前面加的都是读锁,还可以继续获取读锁,否则,等待锁释放后由机会再抢
	* 获得写锁:只有自己创建的节点序列化最小,才能获得写锁,否则,进入等待,直到有锁资源被释放,然后再判断是否有机会得到锁
	* 释放锁:删除节点或者会话失效
	![](http://ols7leonh.bkt.clouddn.com//assert/img/bigdata/zookeeper/lock/2.png)



惊群效应

有序节点的特性

只是监听比自己小一个值的节点

