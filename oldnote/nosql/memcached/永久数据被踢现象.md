---
title: 永久数据被踢现象
categories: memcached   
toc: true  
tags: [memcached]
---



# 1.数据永久被踢现象
 
网上有人反馈为”memcached 数据丢失”,明明设为永久有效,却莫名其妙的丢失了.其实,这要从 2 个方面来找原因:
 
即前面介绍的 惰性删除,与 LRU 最近最少使用记录删除.
 
# 2.分析
1. 如果 slab 里的很多 chunk,已经过期,但过期后没有被 get 过, 系统不知他们已经过期
2. 永久数据很久没 get 了,不活跃,如果新增 item，如果永久数据的活跃度比过期的数据低，则永久数据被踢了.
3. 当然,如果那些非永久数据被 get,也会被标识为 expire,从而不会再踢掉永久数据
 
# 3.解决方案
 
永久数据和非永久数据分开放



# 4.举例
如果数据过期失效了，但是没有访问的话，是不会知道该数据是失效的，因为memcached的惰性失效原理
```txt
#举例
/*
场景：memcached中只能存储3个数据
A（最近最少使用）         B            C（过期失效）       


#如果此时又添加数据D：
会踢掉A，因为A最近最少使用

#如果get(C)
此时会清除C，因为惰性失效原理，此时C的存储位置空出

#如果get(C)之后，又添加D
此时D会占据原来C的位置（因为惰性失效，C已经被清除）


*/
```


# 5.stats查看被踢数据的数量
```
stats

.............
STAT evictions 0               #被踢数据的数量

.................

```








