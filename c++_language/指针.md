[toc]

# 出现野指针

```c
void main(void)
{
  char *p1 = NULL;
  p1 = (char *)malloc(200);
  if(p1 == NULL)
  {
    return;
  }
  
  strcpy(p1, "11111");
  printf("%s\n", p1);
  
  if(p1 != NULL)//这里只是释放了p1指向的堆内存空间，但是指针变量还是有值的，这就是野指针
    free(p1);
  
  if(p1 != NULL)//这里会error，因为指针变量p1还是有值的，所以并不为NULL，此时释放的是一块未知的内存空间
    free(p1);
  
  return;
}

//正确的做法：在释放指针所指向的空间的时候，还要让指针指向NULL，避免指针变成野指针(建议定义指针的时候定义为NULL，释放内存空间的时候，重置指针为NULL)
void main(void)
{
  char *p1 = NULL;
  p1 = (char *)malloc(200);
  if(p1 == NULL)
  {
    return;
  }
  
  strcpy(p1, "11111");
  printf("%s\n", p1);
  
  if(p1 != NULL)//这里只是释放了p1指向的堆内存空间，但是指针变量还是有值的，这就是野指针
  {
    free(p1);
    p1 = NULL;//OK
  }
  
  if(p1 != NULL)
    free(p1);
  
  return;
}
```

