ElasticSearch术语及概念

# 1.索引词（term）


在ES中索引词（term）是一个能被索引的精确值，索引词（term）是可以通过term查询进行准确的搜索的

# 2.文本（text）

文本是一段普通的非结构化的文字，通常文本被分析成一个个的索引词，存储在ES的索引库中，为了让文本能够进行搜素，文本字段需要事先进行分析（analysis），当对文本中的关键字进行查询的时候，搜索引擎应该根据搜索条件搜索出原文本

# 3.分析（analysis）

分析是将文本转化为索引词（term）的过程，分析的结果依赖于分词器，比如：FOO BAR，Foo-Bar和foo bar这几个单词有可能会被分析成为相同的索引词foo 和bar，这些索引词存储在ES的索引库中，当用FoO:bAR进行全文搜索的时候，搜索引擎根据匹配计算也能在索引库中搜索出之前的内容，这就是ES的搜素分析

# 4.集群（cluster）

集群由一个多多个结点组成，在所有结点中，集群有一个唯一的默认的名称（ElasticSearch），当集群中的节点被设置成为相同的集群名称时，就会被自动的加入集群中，需要注意的是**一个节点只能加入一个集群中**

# 5.节点（node）

一个节点是**一个逻辑上的独立的服务**，他是集群的一部分，可以存储数据，并参与集群的索引和搜索功能，就行集群的名字一样，节点也有一个唯一的名字，默认情况下，每个节点会加入名字为“ElasticSearch”的集群中，当网络没有集群运行的时候，只要启动任何一个节点，这个节点会默认生成一个新的集群，这个集群会有一个节点

# 6.路由（routing)

当存储一个文档的时候，他会存储在一个唯一的主分片中，具体是哪个主分片，是通过三列值进行选择，这就是路由，默认情况下，这个值是由文档的ID生成的，如果文档有一个指定的父文档，则从父文档ID中生成，该值可以在存储文档的时候进行修改

# 7.分片（shard）

分片是单个Lucene实例，这是ElasticSearch管理的比较底层的功能，索引是指向主分片和副本分片的逻辑空间

为什么要有分片的概念？

因为一个索引可以存储很大的数据，这些空间可以超过一个节点的物理存储的限制，例如：十亿个文档占用磁盘空间为1TB，仅从单个节点搜索可能会很慢，还有一台物理机也不可能存储这么多的数据，为了解决这一问题，ES将索引分解成多个分片，当你创建一个索引，你可以简单的定义你想要的分片数量，每个分片本身是一个**全功能的，独立的单元**，可以托管在集群中的任何节点上

# 8.主分片（primary shard）

每个文档都存储在一个分片中，**当你存储一个文档的时候，系统会首先存储在主分片中，然后会复制到不同的副本中**，默认情况下，一个索引有5个主分片，你可以事先指定分片的数量，当分片一旦建立，则分片的数量不能修改了（因为路由的时候是根据主分片的数量来决定的），但是副本分片的数量是可以修改的

# 9.副本分片（replica shard）

每一个分片有0个或多个副本，副本主要是主分片的复制，其中有两个目的：

* 增加高可用性：当主分片失败的时候，可以从副本分片中选择一个作为主分片
* 提高性能：当查询的时候可以到主分片或者副本分片中进行查询，这样就可以提高并发查询的速度，默认情况下，一个主分片配有一个副本分片，但副本的数量是可以动态的增加，副本分片必须部署在和主分片相同的节点上


分片（主分片和副本分片）的两个重要性能：
* 允许水平的分隔扩展数据（可以将索引的部分数据放在一个分片上）
* 允许分配和并行操作（当我们并发查询的时候，可以将查询分发到不同的副本分片上，这样来提高并发读）


# 10.复制（replica）

当网络中的某个节点出现问题的时候，复制可以对故障进行转移，保证系统的高可用性，因此ES允许你创建一个或多个拷贝，你的索引分片就形成了所谓的副本或副本分片

复制的2点重要：
* 他提供了高可用性，当节点失败的时候，可以从一个复制的分片中选择一个作为主分片，**需要注意的是：一个复制的分片不会存储在同一个节点中**
* 他允许你水平的扩容，提高并发读，因为搜索可以在所有的副本分片上进行

每个索引可以拆分成为多个分片，索引可以复制0个或多个分片，一旦复制，每个索引就有了主分片和副本分片，分片的数量和副本的数量可以在创建索引时定义，当创建索引后，你随时可以改变副本的数量，但你不能改变分片的数量（因为路由的时候要根据分片的数量进行）

默认情况下，每个索引分配5个分片和一个副本，这意味着你的集群节点至少要有两个节点，你将拥有5个主分片和5个副本分片，共计10个分片

# 11.索引（index）

索引是**具有相同文档结构的集合**，例如：可以有一个客户信息的索引，包括一个目录的索引，一个订单的索引，在系统上索引的名字全部小写，通过这个名字可以用来执行索引（创建），搜索，更新和删除操作

# 12.类型（type）

在索引中可以定义1个或者多个类型，类型是索引的逻辑分区，在一般情况下，**一种类型被定义为具有一组公共字段的文档**，例如：让我们假设你运行一个博客平台，并把所有的数据存储在一个索引中，在这个索引中，你可以定义一种类型为用户数据，一种类型为博客数据，一种类型为评论数据，**其实类型可以理解为关系型数据库中的表**

# 13.文档（document）

文档是存储在ES中的一个Json格式的字符串，他就像关系型数据库中的一行，每个存储在索引中的一个文档都有一个类型（type）和一个ID，每个文档都是一个json对象，存储了0个或者多个字段，或者键值对，**原始的json文档被存储在一个叫做_source的字段中**，当搜索文档的时候默认返回的就偶是这个字段


下图就是索引（index），类型（type），文档（document）的关系图：

![](/elasticsearch/Elasticsearch技术解析与实战_读书笔记/images/1_/index_type_doc_relation.jpg
)


# 14.映射（mapping）

映射就像关系型数据库中的表结构，每一个索引都有一个映射，他定义了索引中的每个字段类型，以及一个索引范围内的设置，一个映射可以事先被定义，或者在第一次存储文档的时候**自动识别**

# 15.字段（field）

文档包含0个或者多个字段，字段可以是一个简单的值（例如字符串，整数，日期），也可以是一个数组或对象的嵌套结构，字段类似于关系型数据库中的列，每个字段都有字段类型，**字段还可以指定如何分析该字段的值**


# 16.来源字段（source field）

默认情况下，你的原文档是存储在_source这个字段中（其实_source也是一个字段，只不过这个字段的类型是对象类型）

# 17.主键（ID）

ID是一个索引中的唯一标识，如果在文档入库的时候没有提供ID，那么系统会自动生成一个ID，文档的index/type/id必须是唯一的























