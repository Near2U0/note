[TOC]

# IP协议及特点

他提供不可靠，无连接的服务，即：依赖其他层的协议进行差错控制

**非可靠**：这意味着它并不保证所要传输的数据一定会到达目的地。（当路由出错导致某个数据传输失败时，会丢掉此数据并发回一个ICMP信息回去。可靠性需要由更上层的协议提供，如TCP协议）。

**无连接**：这代表 IP datagram（数据报）在传输中没有连接起来，他们是一块一块各自分开的，分开独立处理。（比如需要向某个地方发送两个数据报A、B，他们两个有可能会经由不同的路径去到达目的地，有可能B要比A先到达）。

![image-20190901084933712](/Users/chenyansong/Documents/note/images/computeNetwork/image-20190901084933712.png)



```shell
IPv4首部：

version：4比特构成，表示ip首部的版本号

IHL：4比特构成，表示ip首部的大小

TOS：8比特构成，用来表明服务质量，通常由应用指定

Total Length：16比特，总长度包含ip首部和数据部分组成，IP包最长2的16次方 65535

ID：16比特构成，用于ip分片重组，同一分片标示值相同,IP软件维护一个计数器，每产生一个数据包，计数器加1，注意这里是IP分片时候使用的，当IP数据太多(大于MTU)需要分片时，每片的标识一致才能合并回来
#通信术语 最大传输单元（Maximum Transmission Unit，MTU）是指一种通信协议的某一层上面所能通过的最大数据包大小（以字节为单位）。(参考：https://baike.baidu.com/item/mtu/508920?fr=aladdin)

Flags：3比特构成，表示包被分片的相关信息

FO：13比特构成，用来表示被分片的每一个分段相对于原始数据的位置，13位因此最多可以表示2的13次方 8139个相对位置，单位为字节，因此最大可表示原始数据x8=65536

TTL：8比特构成，TTL用于中转多少个路由器，2的8次方 最多256个路由器

Protocal：8比特构成，表示IP首部的下一个首部隶属于哪个协议

Header CheckSum：16比特，2字节构成 首部校验和

Source Adderss：32比特，4字节构成，源地址，表示发送端ip地址

Destination Adderss：32比特，4字节构成，目标地址，表示接收端ip地址

Options：可选项

Padding：填充

data：数据
```



![image-20190901084254666](/Users/chenyansong/Documents/note/images/computeNetwork/image-20190901084254666.png)

路由器是三层设备，主要是对上面几个字段进行控制，来实现路由功能