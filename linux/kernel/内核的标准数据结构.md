[toc]

# 内核的标准数据结构

## 引用计数器

针对某一数据对象，内核需要知道该对象被引用的次数，从而知道是否需要释放该资源，于是就有了引用计数器

```c
struct shared {
    //...
    atomic_t count;
    //...
}
```

分配例程会区分两种情况。如果没有合适的实例，则创建一个新的实例，并将其使用计数器初始化为1。如果有合适的实例存在（可借助散列表来检查，将所有现存实例置于散列表中），将实例的使用计数器加1后返回该实例。  

仅当计数器为0时（在函数开始时为1），该数据结构占用的内存空间才能返还给内存管理子系统 。



## 宏定义do-while只执行一次

do语句在形式上保证宏被“调用”时代码只执行一次

```c
#define FDC_WRITE(reg,val) \ 
     do { \ 
    	dma_wd.dma_mode_status = 0x80 | (reg); \ 
     	udelay(25); \ 
    	dma_wd.fdc_acces_seccount = (val); \ 
     	MFPDELAY(); \ 
     } while(0)
```



## 链表

参见：Linux内核中经典链表 list_head 常见使用方法解析



## 散列表

参见：hlist.md



## 红黑树







## 基数树









